#!/usr/bin/env python

# This script starts routers in the Voltron demo topology - see .png file.  Interface/vswitch values are hardcoded 
# into this script based on the topology file, however, if the user wishes to modify the topology they may do so by
# changing the ovs-vsctl command values below

from os import getpid
from sys import argv, exit
import sys
import time
import subprocess

# example:  sudo ./start_router.py r0

# r0
#gi0/0/0/0 - vlt_br/tag100 to centos/voltron ens4
#gi0/0/0/1 - vlt_br/tag101 to voltron_api_gw_vlan
#gi0/0/0/2 - vlt_br/tag102 to voltron_client1 & 2_vlan
#gi0/0/0/3 - vlt_br/tag103 to r1 gi0/0/0/0
#gi0/0/0/4 - vtl_br/tag104 to r2 gi0/0/0/0
#gi0/0/0/5 - vlt_br/tag105 to r11 gi0/0/0/5
#gi0/0/0/6 - vtl_br/tag106 to r12 gi0/0/0/4
if (sys.argv[1]) in ['r0']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r0.img', '00', 'r0'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr00mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br', 'rtr00xr0', 'tag=100'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br', 'rtr00xr1', 'tag=101'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br', 'rtr00xr2', 'tag=102'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br', 'rtr00xr3', 'tag=103'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br', 'rtr00xr4', 'tag=104'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br', 'rtr00xr5', 'tag=105'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br', 'rtr00xr6', 'tag=106'])

# r10
#gi0/0/0/0 -  vlt_br2/tag100 to openshift
#gi0/0/0/1 -  vlt_br2/tag101 to api_gw_vlan
#gi0/0/0/2 -  vlt_br2/tag102 to client1_vlan
#gi0/0/0/3 -  vlt_br2/tag103 to client2_vlan
#gi0/0/0/4 -  vlt_br2/tag104 to r11 gi0/0/0/0
#gi0/0/0/5 -  vlt_br2/tag105 to r12 gi0/0/0/0
if (sys.argv[1]) in ['r10']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r10.img', '10', 'r10'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr10mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr10xr0', 'tag=100'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr10xr1', 'tag=101'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr10xr2', 'tag=102'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr10xr3', 'tag=103'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr10xr4', 'tag=104'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr10xr5', 'tag=105'])

# r11
#gi0/0/0/0 -  vlt_br2/tag104 to r10 gi0/0/0/4
#gi0/0/0/1 -  vlt_br2/tag106 to r21 gi0/0/0/0
#gi0/0/0/2 -  vlt_br2/tag107 to r22 gi0/0/0/1
#gi0/0/0/3 -  vlt_br2/tag108 to r23 gi0/0/0/1
if (sys.argv[1]) in ['r11']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r11.img', '11', 'r11'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr11mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr11xr0', 'tag=104'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr11xr1', 'tag=106'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr11xr2', 'tag=107'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr11xr3', 'tag=108'])

# r12
#gi0/0/0/0 -  vlt_br2/tag105 to r10 gi0/0/0/5
#gi0/0/0/1 -  vlt_br2/tag109 to r21 gi0/0/0/1
#gi0/0/0/2 -  vlt_br2/tag110 to r22 gi0/0/0/0
#gi0/0/0/3 -  vlt_br2/tag111 to r23 gi0/0/0/0
if (sys.argv[1]) in ['r12']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r12.img', '12', 'r12'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr12mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr12xr0', 'tag=105'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr12xr1', 'tag=109'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr12xr2', 'tag=110'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr12xr3', 'tag=111'])

# r21
#gi0/0/0/0 -  vlt_br2/tag106 to r11 gi0/0/0/1
#gi0/0/0/1 -  vlt_br2/tag109 to r12 gi0/0/0/1
#gi0/0/0/2 -  vlt_br2/tag114 to r73 gi0/0/0/0
#gi0/0/0/3 -  vlt_br2/tag115 to r74 gi0/0/0/1
if (sys.argv[1]) in ['r21']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r21.img', '21', 'r21'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr21mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr21xr0', 'tag=106'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr21xr1', 'tag=109'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr21xr2', 'tag=114'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr21xr3', 'tag=115'])

# r22
#gi0/0/0/0 -  vlt_br2/tag110 to r12 gi0/0/0/2
#gi0/0/0/1 -  vlt_br2/tag107 to r11 gi0/0/0/2
#gi0/0/0/2 -  vlt_br2/tag122 to r73 gi0/0/0/1
#gi0/0/0/3 -  vlt_br2/tag116 to r74 gi0/0/0/0
#gi0/0/0/4 -  vlt_br2/tag117 to r75 gi0/0/0/1
#gi0/0/0/5 -  vlt_br2/tag112 to client3 eth1
if (sys.argv[1]) in ['r22']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r22.img', '22', 'r22'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr22mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr22xr0', 'tag=110'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr22xr1', 'tag=107'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr22xr2', 'tag=122'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr22xr3', 'tag=116'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr22xr4', 'tag=117'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr22xr5', 'tag=112'])

# r23
#gi0/0/0/0 -  vlt_br2/tag111 to r12 gi0/0/0/3
#gi0/0/0/1 -  vlt_br2/tag108 to r11 gi0/0/0/3
#gi0/0/0/2 -  vlt_br2/tag118 to r74 gi0/0/0/4
#gi0/0/0/3 -  vlt_br2/tag119 to r75 gi0/0/0/0
#gi0/0/0/5 -  vlt_br2/tag113 to client3 eth1
if (sys.argv[1]) in ['r23']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r23.img', '23', 'r23'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr23mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr23xr0', 'tag=111'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr23xr1', 'tag=108'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr23xr2', 'tag=118'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr23xr3', 'tag=119'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr23xr4', 'tag=113'])

# r73
#gi0/0/0/0 -  vlt_br2/tag114 to r21 gi0/0/0/2 
#gi0/0/0/1 -  vlt_br2/tag122 to r22 gi0/0/0/2
#gi0/0/0/2 -  vlt_outside_br2
#gi0/0/0/3 -  vlt_br2/tag120 to r74 gi0/0/0/3 
if (sys.argv[1]) in ['r73']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r73.img', '73', 'r73'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr07mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', ' vlt_br2', 'rtr73xr0', 'tag=114'])
    subprocess.call(['ovs-vsctl', 'add-port', ' vlt_br2', 'rtr73xr1', 'tag=122'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_outside_br2', 'rtr73xr2'])
    subprocess.call(['ovs-vsctl', 'add-port', ' vlt_br2', 'rtr73xr3', 'tag=120'])

# r74
#gi0/0/0/0 -  vlt_br2/tag116 to r22 gi0/0/0/2
#gi0/0/0/1 -  vlt_br2/tag115 to r21 gi0/0/0/2
#gi0/0/0/2 -  vlt_br2 vlt_outside_br2
#gi0/0/0/3 -  vlt_br2/tag120 to r73 gi0/0/0/3
#gi0/0/0/4 -  vlt_br2/tag120 to r23 gi0/0/0/2
#gi0/0/0/5 -  vlt_br2/tag120 to r75 gi0/0/0/2
if (sys.argv[1]) in ['r74']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r74.img', '74', 'r74'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr74mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr74xr0', 'tag=116'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr74xr1', 'tag=115'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_outside_br2', 'rtr74xr2'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr74xr3', 'tag=120'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr74xr4', 'tag=118'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr74xr5', 'tag=121'])     

# r75
#gi0/0/0/0 -  vlt_br2/tag116 to r22 gi0/0/0/2
#gi0/0/0/1 -  vlt_br2/tag115 to r21 gi0/0/0/2
#gi0/0/0/2 -  vlt_br2 vlt_outside_br2
#gi0/0/0/3 -  vlt_br2/tag120 to r73 gi0/0/0/3
#gi0/0/0/4 -  vlt_br2/tag120 to r23 gi0/0/0/2
#gi0/0/0/5 -  vlt_br2/tag120 to r75 gi0/0/0/2
if (sys.argv[1]) in ['r75']:
    subprocess.call(['python', 'util/qemu-xrv9k.py', 'r75.img', '75', 'r75'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_mgt_br', 'rtr75mgt1'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr75xr0', 'tag=119'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr75xr1', 'tag=117'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_br2', 'rtr75xr2', 'tag=121'])
    subprocess.call(['ovs-vsctl', 'add-port', 'vlt_outside_br2', 'rtr75xr3'])
  

print "router started"
